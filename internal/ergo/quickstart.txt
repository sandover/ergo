{{BOLD}}ergo quickstart{{RESET}}
{{CYAN}}Complete reference manual. Optimized for agents & humans.{{RESET}}

{{HEADER}}1. INITIALIZE{{RESET}}

{{CMD}}ergo init{{RESET}}
{{COMMENT}}creates .ergo/ in current directory{{RESET}}

{{CMD}}ergo where{{RESET}}
{{COMMENT}}prints the active .ergo path{{RESET}}

{{HEADER}}2. AGENT WORKFLOW{{RESET}}

{{COMMENT}}Recommended agent loop:{{RESET}}
{{COMMENT}}  1. ergo --json claim --agent gpt-5-2-codex@brandon-mbp   (claim oldest ready work){{RESET}}
{{COMMENT}}  2. do the work (write project files: docs/, src/){{RESET}}
{{COMMENT}}  3. printf '{...}' | ergo set <id>       (attach results & mark done){{RESET}}

{{CMD}}ergo --json claim --agent gpt-5-2-codex@brandon-mbp{{RESET}}
{{CMD}}printf '%s' '{"result_path":"docs/x.md","result_summary":"Spec v1","state":"done"}' | ergo set ABCDEF{{RESET}}

{{COMMENT}}Or claim a specific task:{{RESET}}
{{CMD}}ergo claim ABCDEF --agent gpt-5-2-codex@brandon-mbp{{RESET}}
{{COMMENT}}Option: change state later (uses existing claim if present).{{RESET}}
{{CMD}}printf '%s' '{"state":"blocked"}' | ergo set ABCDEF{{RESET}}

{{HEADER}}3. CREATE WORK (JSON stdin){{RESET}}

{{COMMENT}}Use printf '%s' for reliable JSON delivery. All fields are strings.{{RESET}}

{{CMD}}printf '%s' '{"title":"Login","body":"Implement signup","epic":"OFKSTE"}' | ergo new task{{RESET}}
{{CMD}}printf '%s' '{"title":"Auth","body":"Signup/Login epic"}' | ergo new epic{{RESET}}
{{COMMENT}}prints ID (e.g. OFKSTE){{RESET}}

{{COMMENT}}Atomic Create-and-Claim (preferred for dynamic tasking):{{RESET}}
{{CMD}}printf '%s' '{"title":"Fix CVE","claim":"agent-1"}' | ergo new task{{RESET}}
{{COMMENT}}claim implies state=doing unless state is explicitly set.{{RESET}}

{{HEADER}}4. DEPENDENCIES{{RESET}}

{{COMMENT}}'dep A B' means A depends on B (B blocks A).{{RESET}}
{{CMD}}ergo dep TASK_A TASK_B{{RESET}}

{{CMD}}ergo list --ready{{RESET}}
{{COMMENT}}only tasks with ALL deps done|canceled are READY.{{RESET}}

{{HEADER}}5. UPDATE & FAILURES{{RESET}}

{{CMD}}printf '%s' '{"state":"blocked"}' | ergo set ABCDEF{{RESET}}
{{COMMENT}}explicit block (waiting on human/external){{RESET}}

{{CMD}}printf '%s' '{"state":"error"}' | ergo set ABCDEF{{RESET}}
{{COMMENT}}requires claim (agent-id) to show who failed.{{RESET}}
{{COMMENT}}if unclaimed, pass --agent (or set claim explicitly in JSON).{{RESET}}

{{HEADER}}6. ATTACH RESULTS{{RESET}}

{{COMMENT}}Results are pointers to project files (relative paths).{{RESET}}
{{CMD}}printf '%s' '{"result_path":"docs/report.md","result_summary":"Final report"}' | ergo set GHIJKL{{RESET}}

{{CMD}}ergo show GHIJKL --json | jq '.results[]'{{RESET}}
{{COMMENT}}returns {path, file_url, sha256_at_attach, attached_at, ...}{{RESET}}

{{HEADER}}7. EPIC HIERARCHIES{{RESET}}

{{COMMENT}}Epics are complete when all child tasks are done|canceled.{{RESET}}
{{COMMENT}}Epics have no state.{{RESET}}
{{COMMENT}}Epic-to-Epic dependencies block all tasks in the dependent epic.{{RESET}}

{{CMD}}ergo dep EPIC_A EPIC_B{{RESET}}

{{HEADER}}REFERENCE: JSON OUTPUT SCHEMA{{RESET}}

{{COMMENT}}Task (list/show):{{RESET}}
{{COMMENT}}  {id, uuid, epic_id, state, worker, claimed_by, claimed_at, title, body, deps[], results[]}{{RESET}}

{{HEADER}}REFERENCE: TITLE + BODY{{RESET}}
{{COMMENT}}Title and body are separate fields.{{RESET}}
{{COMMENT}}Use JSON title for the task name; JSON body for details.{{RESET}}
{{COMMENT}}Legacy: if title is missing, ergo derives it from the first non-empty non-heading line of body.{{RESET}}

{{COMMENT}}Result:{{RESET}}
{{COMMENT}}  {summary, path, file_url, sha256_at_attach, attached_at}{{RESET}}

{{HEADER}}REFERENCE: STATE MACHINE{{RESET}}

{{COMMENT}}Transitions:{{RESET}}
{{COMMENT}}  todo     → doing, done, blocked, canceled{{RESET}}
{{COMMENT}}  doing    → todo, done, blocked, canceled, error{{RESET}}
{{COMMENT}}  blocked  → todo, doing, done, canceled{{RESET}}
{{COMMENT}}  done/can → todo (reopen){{RESET}}
{{COMMENT}}  error    → todo, doing, canceled{{RESET}}

{{COMMENT}}Invariants:{{RESET}}
{{COMMENT}}  state=doing/error requires claim.{{RESET}}
{{COMMENT}}  for implicit claims, pass --agent (or set claim explicitly in JSON).{{RESET}}
{{COMMENT}}  state=todo/done/canceled clears claim.{{RESET}}

{{HEADER}}REFERENCE: RULES{{RESET}}

{{COMMENT}}- dep: task->task or epic->epic only.{{RESET}}
{{COMMENT}}- cycles: forbidden (rejected by dep).{{RESET}}
{{COMMENT}}- worker is advisory; claim does not filter by worker.{{RESET}}
{{COMMENT}}- recommended agent id format: model@host (not enforced).{{RESET}}
