{{BOLD}}ergo{{RESET}} — fast, concurrency-safe task orchestration for agents. humans welcome.

{{HEADER}}USAGE{{RESET}}
  ergo [global flags] <command> [args]

{{HEADER}}COMMANDS{{RESET}}
  init [dir]                              create .ergo/ in dir (default: current dir)

  new epic                                create epic from JSON stdin (prints ID)
  new task                                create task from JSON stdin (prints ID)

  set <id>                                update task/epic from JSON stdin

  list [--epic <id>] [--ready|--blocked] [--epics] [--all]
                                          list tasks; --epics shows only epics
                                          canceled tasks hidden unless --all
  show <id>                               show epic or task details

  next [--epic <id>] [--peek]             claim oldest READY task, set doing, print ID + body
                                          --peek shows without claiming; exit 3 if none

  dep <A> <B>                             add dependency: A depends on B (B blocks A)
  dep rm <A> <B>                          remove dependency

  where                                   print active .ergo directory path
  compact                                 rewrite log to current state (drops history)
  quickstart                              complete reference manual

{{HEADER}}GLOBAL FLAGS{{RESET}}
  --dir <path>                            discovery start dir (or explicit .ergo dir)
  --as <any|agent|human>                  filter READY/BLOCKED and next (default: any)
  --agent <id>                            claim identity (default: username@hostname)
  --json                                  JSON output (default: text)
  --readonly                              block commands that write
  --lock-timeout <duration>               default 30s; 0 = fail fast
  -h, --help                              show help
  -V, --version                           print version

{{HEADER}}FOR AGENTS{{RESET}}
  {{BOLD}}ALWAYS use '--json' arg to read structured output.
  {{BOLD}}ALWAYS use printf for JSON input (not heredocs, which break in some terms).
  Before using, first run `ergo quickstart` for complete reference and workflow.

{{HEADER}}JSON INPUT (stdin only){{RESET}}
  All mutations (new, set) read JSON from stdin:

    printf '%s' '{"title":"Auth","body":"Implement login"}' | ergo new task
    printf '%s' '{"state":"done"}' | ergo set TASKID

  Fields (all strings):
    title           required for new, optional for set
    body            optional (defaults to title if omitted)
    epic            epic ID or "" to unassign
    worker          any|agent|human
    state           todo|doing|done|blocked|canceled|error
    claim           agent ID or "" to unclaim
    result_path     file path (requires result_summary)
    result_summary  one-liner (requires result_path)

{{HEADER}}JSON OUTPUT (--json flag){{RESET}}
  list → array:   [{id, title, state, ready, blocked, claimed_by, ...}]
  show → object:  {id, body, deps, rdeps, state, results, ...}
