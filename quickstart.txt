{{BOLD}}ergo quickstart{{RESET}}
{{CYAN}}Complete reference manual. Run these commands as you read.{{RESET}}
{{CYAN}}For quick syntax lookup, use: ergo --help{{RESET}}

{{HEADER}}1. INITIALIZE{{RESET}}

{{CMD}}mkdir demo && cd demo{{RESET}}
{{CMD}}ergo init{{RESET}}

{{COMMENT}}creates .ergo/ with events.jsonl{{RESET}}
{{COMMENT}}ergo discovers .ergo/ like git finds .git/{{RESET}}

{{CMD}}ergo where{{RESET}}
{{COMMENT}}prints the active .ergo path{{RESET}}

{{HEADER}}2. CREATE AN EPIC{{RESET}}

{{CMD}}echo '{"title":"Build auth system"}' | ergo new epic{{RESET}}
{{COMMENT}}prints epic ID, e.g. OFKSTE (6-char base32){{RESET}}

{{HEADER}}3. CREATE TASKS{{RESET}}

{{COMMENT}}tasks are created by piping JSON to stdin:{{RESET}}
{{CMD}}echo '{"title":"Design token format","body":"Design token format","epic":"OFKSTE"}' | ergo new task{{RESET}}
{{CMD}}echo '{"title":"Implement JWT signing","body":"Implement JWT signing","epic":"OFKSTE"}' | ergo new task{{RESET}}
{{CMD}}echo '{"title":"Add refresh tokens","body":"Add refresh tokens","epic":"OFKSTE"}' | ergo new task{{RESET}}

{{COMMENT}}each prints a task ID, e.g. FUM56H (6-char base32){{RESET}}
{{CMD}}ergo list{{RESET}}

{{HEADER}}4. JSON INPUT SCHEMA{{RESET}}

{{COMMENT}}all mutations use the same JSON schema:{{RESET}}

{{COMMENT}}  title           (required for new; optional for set){{RESET}}
{{COMMENT}}  body            (required for new; optional for set){{RESET}}
{{COMMENT}}  epic            (optional; epic ID or "" to unassign){{RESET}}
{{COMMENT}}  worker          (optional; any|agent|human){{RESET}}
{{COMMENT}}  state           (optional; todo|doing|done|blocked|canceled|error){{RESET}}
{{COMMENT}}  claim           (optional; agent ID or "" to unclaim){{RESET}}
{{COMMENT}}  result_path     (optional; requires result_summary){{RESET}}
{{COMMENT}}  result_summary  (optional; requires result_path){{RESET}}

{{COMMENT}}validation errors return structured JSON:{{RESET}}
{{CMD}}echo '{}' | ergo new task --json{{RESET}}
{{COMMENT}}→ {"error":"validation_failed","message":"invalid input","missing":["title","body"]}{{RESET}}

{{COMMENT}}multi-line body (use heredoc for readability):{{RESET}}
{{CMD}}ergo new task <<'EOF'
{"title":"Refactor auth","body":"1. Extract token validation\n2. Add refresh flow\n3. Update tests"}
EOF{{RESET}}

{{HEADER}}5. ADD DEPENDENCIES{{RESET}}

{{COMMENT}}'dep A B' means A depends on B (B blocks A){{RESET}}
{{COMMENT}}JWT signing depends on token format design:{{RESET}}
{{CMD}}ergo dep ABCDEF GHIJKL{{RESET}}
{{COMMENT}}refresh tokens depend on JWT signing:{{RESET}}
{{CMD}}ergo dep MNOPQR ABCDEF{{RESET}}
{{CMD}}ergo list --blocked{{RESET}}
{{COMMENT}}shows ABCDEF and MNOPQR (waiting on deps){{RESET}}

{{CMD}}ergo list --ready{{RESET}}
{{COMMENT}}only GHIJKL is ready (no unmet deps){{RESET}}
{{CMD}}ergo dep rm MNOPQR ABCDEF{{RESET}}
{{COMMENT}}removes the dependency if needed{{RESET}}

{{HEADER}}6. WORK ON TASKS{{RESET}}

{{CMD}}ergo next{{RESET}}
{{COMMENT}}claims oldest ready task, sets state=doing, prints it{{RESET}}
{{COMMENT}}if no ready tasks, exits with code 3{{RESET}}
{{CMD}}ergo next --peek{{RESET}}
{{COMMENT}}see what's next without claiming{{RESET}}

{{COMMENT}}mark your work done:{{RESET}}
{{CMD}}echo '{"state":"done"}' | ergo set GHIJKL{{RESET}}
{{CMD}}ergo list --ready{{RESET}}

{{HEADER}}7. UPDATE TASKS{{RESET}}

{{CMD}}echo '{"title":"Implement JWT signing (HS256)"}' | ergo set ABCDEF{{RESET}}
{{CMD}}echo '{"state":"blocked"}' | ergo set ABCDEF{{RESET}}
{{COMMENT}}explicit block (waiting on external input){{RESET}}

{{CMD}}echo '{"state":"todo"}' | ergo set ABCDEF{{RESET}}
{{COMMENT}}unblock when ready to resume{{RESET}}

{{COMMENT}}multiple fields in one update:{{RESET}}
{{CMD}}echo '{"state":"doing","claim":"my-agent"}' | ergo set ABCDEF{{RESET}}

{{HEADER}}8. HANDLE FAILURES{{RESET}}

{{COMMENT}}if a task fails, mark it as error (preserves who failed):{{RESET}}
{{CMD}}echo '{"state":"error"}' | ergo set ABCDEF{{RESET}}
{{COMMENT}}note: state=error requires a claim to show who failed{{RESET}}

{{COMMENT}}retry the failed task:{{RESET}}
{{CMD}}echo '{"state":"doing","claim":"my-agent"}' | ergo set ABCDEF{{RESET}}
{{COMMENT}}or reassign to someone else:{{RESET}}
{{CMD}}echo '{"state":"todo"}' | ergo set ABCDEF{{RESET}}
{{COMMENT}}or give up:{{RESET}}
{{CMD}}echo '{"state":"canceled"}' | ergo set ABCDEF{{RESET}}

{{HEADER}}9. ATTACH RESULTS{{RESET}}

{{COMMENT}}tasks can have result files — visible in normal tools (editor, finder):{{RESET}}
{{CMD}}echo "# Analysis Report" > docs/analysis.md{{RESET}}
{{CMD}}echo '{"result_path":"docs/analysis.md","result_summary":"Token format analysis"}' | ergo set GHIJKL{{RESET}}

{{COMMENT}}results are attached, not moved:{{RESET}}
{{COMMENT}}  - file stays in your project (not in .ergo/){{RESET}}
{{COMMENT}}  - ergo stores: path, sha256, mtime, git commit (at attach time){{RESET}}
{{COMMENT}}  - humans open docs/analysis.md directly; agents use show --json{{RESET}}

{{CMD}}ergo show GHIJKL{{RESET}}
{{COMMENT}}shows result summary, path, and file:// URL{{RESET}}

{{CMD}}ergo show GHIJKL --json | jq '.results'{{RESET}}
{{COMMENT}}structured: path, file_url, sha256_at_attach, etc.{{RESET}}

{{COMMENT}}attach multiple results by repeating set:{{RESET}}
{{CMD}}echo '{"result_path":"docs/spec.md","result_summary":"Final spec document"}' | ergo set GHIJKL{{RESET}}

{{HEADER}}10. CREATE-AND-CLAIM (atomic){{RESET}}

{{COMMENT}}create a task already claimed and in-progress:{{RESET}}
{{CMD}}echo '{"title":"Urgent fix","body":"Urgent fix","state":"doing","claim":"my-agent"}' | ergo new task{{RESET}}

{{COMMENT}}create a task that's already done with results:{{RESET}}
{{CMD}}echo '{"title":"Prior analysis","body":"Prior analysis","state":"done","result_path":"docs/prior.md","result_summary":"Previous work"}' | ergo new task{{RESET}}

{{HEADER}}11. HUMAN VS AGENT TASKS{{RESET}}

{{COMMENT}}some tasks need human judgment:{{RESET}}
{{CMD}}echo '{"title":"Choose token expiry policy","body":"Choose token expiry policy","epic":"OFKSTE","worker":"human"}' | ergo new task{{RESET}}
{{CMD}}ergo list --ready --as human{{RESET}}

{{COMMENT}}agents filter for their work:{{RESET}}
{{CMD}}ergo list --ready --as agent{{RESET}}
{{CMD}}ergo next --as agent{{RESET}}

{{HEADER}}12. EPIC HIERARCHIES{{RESET}}

{{COMMENT}}epics can depend on other epics (nested work):{{RESET}}
{{CMD}}echo '{"title":"Design phase","body":"Design phase"}' | ergo new epic{{RESET}}
{{CMD}}echo '{"title":"Build phase","body":"Build phase"}' | ergo new epic{{RESET}}
{{CMD}}echo '{"title":"Deploy phase","body":"Deploy phase"}' | ergo new epic{{RESET}}

{{COMMENT}}Build depends on Design, Deploy depends on Build:{{RESET}}
{{CMD}}ergo dep STUVWX YZABCD{{RESET}}
{{CMD}}ergo dep EFGHIJ STUVWX{{RESET}}

{{COMMENT}}tasks in Build are blocked until Design's tasks are done{{RESET}}
{{COMMENT}}an epic is "complete" when all its tasks are done|canceled{{RESET}}

{{HEADER}}13. AGENT INTEGRATION{{RESET}}

{{COMMENT}}agents should use --json for structured output:{{RESET}}
{{CMD}}ergo --json list --ready --as agent{{RESET}}
{{CMD}}ergo --json next --as agent{{RESET}}

{{COMMENT}}recommended agent loop:{{RESET}}
{{COMMENT}}  1. ergo --json next --as agent  (claim work){{RESET}}
{{COMMENT}}  2. do the work{{RESET}}
{{COMMENT}}  3. write results to project files (e.g., docs/, reports/){{RESET}}
{{COMMENT}}  4. echo '{"result_path":"...","result_summary":"..."}' | ergo set <id>{{RESET}}
{{COMMENT}}  5. echo '{"state":"done"}' | ergo set <id>  (or state=error if failed){{RESET}}

{{COMMENT}}find results from other tasks:{{RESET}}
{{CMD}}ergo show <id> --json | jq '.results[] | {path, summary, sha256_at_attach}'{{RESET}}

{{HEADER}}REFERENCE: READY / BLOCKED / EPIC COMPLETION{{RESET}}

{{COMMENT}}READY (tasks only):{{RESET}}
{{COMMENT}}  state=todo, unclaimed, worker matches --as, all task deps done|canceled,{{RESET}}
{{COMMENT}}  and all epic-deps of the task's epic are complete.{{RESET}}

{{COMMENT}}BLOCKED (tasks only):{{RESET}}
{{COMMENT}}  state=blocked, OR (state=todo AND unmet task deps), OR task's epic has{{RESET}}
{{COMMENT}}  incomplete epic-deps.{{RESET}}

{{COMMENT}}EPIC COMPLETION:{{RESET}}
{{COMMENT}}  An epic is complete when all its tasks are done or canceled.{{RESET}}
{{COMMENT}}  Epic-to-epic deps: tasks in epic A are blocked until epic B is complete.{{RESET}}

{{HEADER}}REFERENCE: STATE MACHINE{{RESET}}

{{COMMENT}}valid state transitions:{{RESET}}
{{COMMENT}}  todo     → doing, done, blocked, canceled{{RESET}}
{{COMMENT}}  doing    → todo, done, blocked, canceled, error{{RESET}}
{{COMMENT}}  blocked  → todo, doing, done, canceled{{RESET}}
{{COMMENT}}  done     → todo (reopen only){{RESET}}
{{COMMENT}}  canceled → todo (reopen only){{RESET}}
{{COMMENT}}  error    → todo, doing, canceled (retry, reassign, or give up){{RESET}}

{{COMMENT}}claim invariants:{{RESET}}
{{COMMENT}}  state=doing requires claim{{RESET}}
{{COMMENT}}  state=error requires claim (shows who failed){{RESET}}
{{COMMENT}}  state=todo/done/canceled clears claim{{RESET}}

{{HEADER}}REFERENCE: DEPENDENCY RULES{{RESET}}

{{COMMENT}}  task → task: allowed{{RESET}}
{{COMMENT}}  epic → epic: allowed{{RESET}}
{{COMMENT}}  task ↔ epic: forbidden (no mixing){{RESET}}
{{COMMENT}}  self-dep:    forbidden (A cannot depend on A){{RESET}}
{{COMMENT}}  cycles:      forbidden (A→B→...→A rejected){{RESET}}
